[{"title":"Code Server","url":"/posts/2025/07/code-server/","content":"在 Ubuntu 16.04 Server 上安装 code-server（Web 版 VSCode）的步骤如下使用.deb 包安装对于 Ubuntu 16.04系统，推荐通过.deb 包来安装 code-server，这样能避免 npm 安装时出现的权限问题：\n# 获取最新版本的下载链接（请替换为实际的最新版本）VERSION=4.14.1wget https://github.com/coder/code-server/releases/download/v$VERSION/code-server_$&#123;VERSION&#125;_amd64.deb# 安装.deb包sudo dpkg -i code-server_$&#123;VERSION&#125;_amd64.deb# 修复依赖（如果有缺失的依赖）sudo apt-get install -f\n\n\n持久化运行 code-server\n如果你使用的是.deb 包安装的 code-server，建议通过 systemd 管理服务：\n# 设置服务开机自启sudo systemctl enable code-server@$USER# 启动服务sudo systemctl start code-server@$USER# 查看服务状态sudo systemctl status code-server@$USER\n\n修改配置文件\n#使用 Node.js 内置的 crypto 模块生成哈希密码：nano ~/.config/code-server/config.yaml\n\n推荐配置示例：\nbind-addr: 0.0.0.0:8080       # 允许外部访问，注意安全组设置auth: password                 # 认证方式password: your_strong_password # 强密码cert: false                     # 启用HTTPS（需要证书）\n\n# 重载 Systemdsudo systemctl daemon-reload# 启动服务sudo systemctl restart code-server@$USER\n\n常见问题解决其他安装1. 安装 Node.js 16.xcode-server 依赖 Node.js 12+，但 Ubuntu 16.04 的默认仓库版本过低，需通过 NodeSource 安装：\n# 添加 NodeSource 仓库curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -# 安装 Node.js 和 npmsudo apt-get install -y nodejs\n\n验证版本：\nnode -v  # 应输出 v16.x.xnpm -v   # 应输出 8.x.x\n\n\n2. 安装 code-server使用 npm 全局安装最新稳定版：\nsudo npm install -g --unsafe-perm code-server@4.14.1\n\n注意：选择 4.14.1 版本是为了兼容 Ubuntu 16.04 的较旧依赖环境。\n3. 配置 code-server创建配置目录并生成默认配置文件：\nmkdir -p ~/.config/code-servercode-server --config ~/.config/code-server/config.yaml\n\n编辑配置文件：\nnano ~/.config/code-server/config.yaml\n\n修改内容如下（示例）：\nbind-addr: 0.0.0.0:8080  # 监听所有 IP，端口 8080auth: password           # 密码认证password: your_password  # 改为强密码cert: false              # 暂不使用 HTTPS\n\n4. 创建 Systemd 服务创建服务文件以便后台运行：\nsudo nano /etc/systemd/system/code-server.service\n\n内容如下（替换 your_username 为你的用户名）：\n[Unit]Description=code-serverAfter=networking.service[Service]Type=simpleUser=userEnvironment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/loca$ExecStart=/usr/bin/code-server --config /home/your_username/.config/code-server/config.yamlRestart=always[Install]WantedBy=multi-user.target\n\n5. 启动服务并设置开机自启# 重载 Systemdsudo systemctl daemon-reload# 启动服务sudo systemctl start code-server# 设置开机自启sudo systemctl enable code-server\n\n6. 配置防火墙（如果启用）sudo ufw allow 8080sudo ufw reload\n\n7. 访问 Web 界面http://服务器IP:8080\n\n输入配置的密码登录。\n","categories":["AI"],"tags":["code-server"]},{"title":"Chang Yan","url":"/posts/2025/07/chang-yan/","content":"畅言 （中国）畅言是业界领先的社交评论系统，同时支持 PC 端和移动端的访问方式，提供了一种全新的网站评论方式。畅言拥有多种常用账号登录、三重过滤机制、实时数据统计、数据快速导出、全面支持移动端等领先功能。完全满足各大网站的用户登录、评论、分享、审核需求。\n1. 创建账号或登录畅言，然后添加站点以获取 APP ID 和 APP KEY注册账户：\n用户类型:\n\n 通用网站用户（一般网站用户选择此项）\n CMS平台用户（WordPress，DedeCMS，Z-Blog 用户选择此选项）\n Android &amp; IOS用户（APP开发者选择此项）\n\n站点名称: *\n  XXX’s Blog\n\n请填写站点名称,不超过15个字\n\n站点类型:\n\n \n生活娱乐获取lite版:\n\n \n确认获取\n\n\n确定\n\n\n2.将取值 enable 设置为 true ，并将获取的 APP ID（ appid ）和 APP KEY（ appkey ）添加到 NexT 配置文件的 changyan Section 中，如下所示NexT 配置文件\n# Multiple Comment System Supportcomments:# Available values: tabs | buttonsstyle: tabs# Choose a comment system to be displayed by default.# Available values: disqus | disqusjs | changyan | livere | gitalk | utterancesactive: changyan# Setting `true` means remembering the comment system selected by the visitor.storage: true# Lazyload all comment systems.lazyload: false# Modify texts or order for any naves, here are some examples.nav:  #disqus:  #  text: Load Disqus  #  order: -1  #gitalk:  #  order: -2\n\n# changyanchangyan:  enable: false  appid:  appkey:  count: true\n\n注意：评论后，您需要一些时间才能看到评论数量的增加。\n\n","categories":["Hexo"],"tags":["chang-yan"]},{"title":"Github Hexo","url":"/posts/2025/07/github-hexo/","content":"GitHub+Hexo搭建个人免费博客网站本文介绍如何使用GitHub + Hexo搭建个人免费博客网站，所有内容亲测，绝对可用。\n一、准备工作GitHub账号需要有一个GitHub账号，没有的话到 官网 申请一个。注册很简单，不懂的话可以参考 GitHub申请账号\n安装Git在自己电脑上安装好Git，hexo部署到GitHub时要用。网上找篇教程或者参考 Git安装。\n安装NodeJS在自己电脑上安装好NodeJS，Hexo是基于NodeJS编写的，所以需要安装NodeJS和npm工具。网上找篇教程或者参考 NodeJS安装及配置。\n\n\n二、创建仓库在GitHub上创建一个新的代码仓库用于保存我们的网页。\n点击Your repositories，进入仓库页面。\n点击New按钮，进入仓库创建页面。\n填写仓库名，格式必须为&lt;用户名&gt;.github.io，然后点击Create repository。\n点击creating a new file创建一个新文件，作为我们网站的主页。\n新文件的名字必须为index.html，内容先随便写一个简单的，内容示例如下，填写之后点击Commit new file提交。\n&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;title&gt;XXX&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;h1&gt;XXX的个人主页&lt;/h1&gt;    &lt;h1&gt;Hello World!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;\n\nGitHub 中找到我们主页的地址为 https:&#x2F;&#x2F;&lt;用户名&gt;.github.io&#x2F;\n浏览器中访问，展示成功。\n这里创建的网页是非常简单的，只是为了演示下GitHub 的使用方式。\n三、发布到GitHubnpm install hexo-deployer-git --save\n\n使用 SSH 密钥认证生成 SSH 密钥（如果之前没生成过）\nssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;\n\n把公钥添加到 GitHub 账户复制~&#x2F;.ssh&#x2F;id_rsa.pub文件的内容。登录 GitHub，依次点击 Settings→SSH and GPG keys→New SSH key，粘贴公钥。更新 Hexo 配置文件把 deploy 部分的 repo 修改为 SSH 格式：\n编辑 nano _config.yml\ndeploy:  type: git  repo: &lt;git@github.com&gt;:&lt;用户名&gt;/&lt;用户名&gt;.github.io.git  branch: main\n\n验证 SSH 连接\nbashssh -T git@github.com\n要是看到Hi &lt;用户名&gt;! You’ve successfully authenticated…，就说明连接成功了。\n参考：本人博客\n","categories":["Hexo"],"tags":["github-hexo"]},{"title":"Hello World","url":"/posts/2025/07/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new posthexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun serverhexo server\n\n\nMore info: Server\nGenerate static fileshexo generate\n\nMore info: Generating\nDeploy to remote siteshexo deploy\n\nMore info: Deployment\n","categories":["Hexo"],"tags":["hello-world"]},{"title":"Hexo Links","url":"/posts/2025/07/hexo-links/","content":"Hexo 友情链接1. 创建友链hexo new page links\n\n2. 配置友链gedit themes/next/_config.yml  \n\nmenu:links: /links/ || fa fa-link\n\ngedit themes/next/languages/zh-CN.yml \n\nmenu:links: 友链\n\n\n3. 编辑友链gedit source/links/index.md\n\n---title: 友情链接author: Ma Jiangdate: 2025-07-11 14:39:28layout: pagelinks:  - name: Ma Jiang&#x27;s Blog    desc: Stay hungry,stay foolish.    link: https://majiang2025.github.io    avatar: https://majiang2025.github.io/images/favicon.png---&lt;style&gt; #links &#123; margin-top: 5rem; &#125;.links-content &#123; margin-top:1rem; &#125;.link-navigation &#123;  display: flex;  flex-wrap: wrap;  gap: 1rem;  justify-content: center;&#125;.card &#123;  width: 300px;  font-size: 1rem;  padding: 10px 20px;  border-radius: 4px;  transition-duration: 0.15s;  margin-bottom: 1rem;  display:flex;  background-color: #ffffff;  border: 1px solid #eaeaea;&#125;.card:hover &#123;  transform: scale(1.03);  box-shadow: 0 4px 12px rgba(0,0,0,0.08);&#125;.card .ava &#123;  width: 3rem!important;  height: 3rem!important;  margin:0!important;  margin-right: 1em!important;  border-radius:4px;  object-fit: cover;&#125;.card .card-header &#123;  width: 236px;&#125;.card .card-header a &#123;  color: #2bbc8a;  font-weight: bold;  text-decoration: none;&#125;.card .card-header a:hover &#123;  color: #d480aa;  text-decoration: none;&#125;.card .card-header .info &#123;  color:#a3a3a3;  font-size:14px;  white-space: nowrap;  text-overflow: ellipsis;  overflow: hidden;&#125;@media (max-width: 768px) &#123;  .card &#123;    width: 100%;    margin-left: auto;    margin-right: auto;  &#125;  .card .card-header &#123; width: calc(100% - 3rem - 1em); &#125;&#125;.with-love i &#123;  animation: heartBeat 1.5s infinite;  color: #ff4d6d;&#125;@keyframes heartBeat &#123;  0%, 100% &#123; transform: scale(1); &#125;  50% &#123; transform: scale(1.3); &#125;&#125;.note &#123;  padding: 1em;  margin: 1em 0;  border-radius: 4px;  position: relative;&#125;.note.warning &#123;  background-color: #fff6f6;  border-left: 4px solid #ff4d4f;&#125;.note.success &#123;  background-color: #f6ffed;  border-left: 4px solid #52c41a;&#125;/* 图片预优化（无后端时的替代方案） */.ava &#123;  /* 强制限制尺寸，避免图片过大 */  max-width: 48px;  max-height: 48px;  /* 压缩图片显示（视觉上缩小，实际文件大小不变） */  image-rendering: optimizeSpeed;&#125;/* 布局优化：避免重排重绘 */.card &#123;  display: flex;  align-items: center;  gap: 12px;  padding: 8px 0;  /* 固定高度，避免加载时布局跳动 */  min-height: 64px;&#125;/* 减少渲染阻塞：合并样式 */.card-header &#123;  flex: 1;&#125;.info &#123;  font-size: 12px;  color: #666;  /* 限制描述文字高度，避免占用过多空间 */  overflow: hidden;  text-overflow: ellipsis;  display: -webkit-box;  -webkit-line-clamp: 1;  -webkit-box-orient: vertical;&#125;&lt;/style&gt;&lt;div class=&quot;links-content&quot;&gt;&lt;div class=&quot;link-navigation&quot;&gt;&#123;% for link in links %&#125;&lt;div class=&quot;card&quot;&gt;  &lt;img    class=&quot;ava nomediumzoom&quot;    src=&quot;&#123;&#123; link.avatar &#125;&#125;&quot;    alt=&quot;&#123;&#123; link.name &#125;&#125;的头像&quot;    loading=&quot;lazy&quot;    width=&quot;48&quot;    height=&quot;48&quot;    style=&quot;object-fit: cover;&quot; /&gt;  &lt;div class=&quot;card-header&quot;&gt;    &lt;div&gt;&lt;a href=&quot;&#123;&#123; link.link &#125;&#125;&quot; target=&quot;_blank&quot;&gt; &#123;&#123; link.name &#125;&#125; &lt;/a&gt; &lt;/div&gt;    &lt;div class=&quot;info&quot;&gt;&#123;&#123; link.desc &#125;&#125;&lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&#123;% endfor %&#125;&lt;!-- 纯前端分页加载逻辑 --&gt;&lt;script&gt;  // 初始化：隐藏所有卡片，只显示首屏内容  document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;    const cards = document.querySelectorAll(&#x27;.card&#x27;);    const visibleCount = 15; // 首屏显示数量（根据实际高度调整）    // 隐藏超出首屏的卡片    cards.forEach((card, index) =&gt; &#123;      if (index &gt;= visibleCount) &#123;        card.style.display = &#x27;none&#x27;;        card.dataset.hidden = &#x27;true&#x27;; // 标记为隐藏      &#125;    &#125;);    // 监听滚动，加载更多    window.addEventListener(&#x27;scroll&#x27;, loadOnScroll);  &#125;);  // 滚动加载函数  function loadOnScroll() &#123;    const hiddenCards = document.querySelectorAll(&#x27;.card[data-hidden=&quot;true&quot;]&#x27;);    if (hiddenCards.length === 0) &#123;      // 所有内容已加载，移除监听      window.removeEventListener(&#x27;scroll&#x27;, loadOnScroll);      return;    &#125;    // 当滚动到页面底部附近时加载    if (window.innerHeight + window.scrollY &gt;= document.body.offsetHeight - 500) &#123;      // 每次加载5张，避免一次性渲染过多      const toLoad = Array.from(hiddenCards).slice(0, 5);      toLoad.forEach(card =&gt; &#123;        card.style.display = &#x27;flex&#x27;; // 显示卡片        card.removeAttribute(&#x27;data-hidden&#x27;);      &#125;);    &#125;  &#125;&lt;/script&gt;&lt;/div&gt;------#### 留言换链友链格式：- name: Ma Jiang&#x27;s Blog  desc: Stay hungry,stay foolish.  link: &lt;https://majiang2025.github.io&gt;  avatar: &lt;https://majiang2025.github.io/images/favicon.png&gt;\n","categories":["Hexo"],"tags":["hexo-links"]},{"title":"Jupyter Notebook","url":"/posts/2025/07/jupyter-notebook/","content":"在 Ubuntu 16.04 Server 上安装 Jupyter Notebook，可以按照以下步骤进行1. 更新系统软件包首先更新系统的软件包列表和已安装的软件包：\nsudo apt-get updatesudo apt-get upgrade -y\n\n2. 安装 Python 和 pipJupyter Notebook 依赖于 Python，Ubuntu 16.04 默认安装了 Python 2.7 和 Python 3.5，这里建议安装 Python 3.6 和 pip3.6：\n#添加 deadsnakes PPA 仓库sudo add-apt-repository ppa:deadsnakes/ppasudo apt-get update#安装 Python 3.6 和 pip 工具sudo apt-get install python3.6 python3.6-pip -y\n\n\n若上述方法找不到python3.6，你可以从源码编译安装 Python 3.6\n# 安装编译依赖sudo apt-get install build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev wget# 安装SQLite开发库和编译依赖sudo apt-get install -y libsqlite3-dev sqlite3 build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev# 下载并解压源码wget https://www.python.org/ftp/python/3.6.15/Python-3.6.15.tgztar -xf Python-3.6.15.tgzcd Python-3.6.15# 配置并编译# 重新配置并编译（保留原有配置，添加sqlite支持）./configure --enable-optimizations --with-system-ffi --with-computed-gotosmake -j$(nproc)sudo make altinstall\n\n#设置默认 Python 版本cdsudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.5 1sudo update-alternatives --install /usr/bin/python3 python3 /usr/local/bin/python3.6 2sudo update-alternatives --config python3\n\n3. pip3 换清华源使用 Python 3.6，若不兼容，你可以尝试重新安装兼容版本的 pip。\n# 删除当前有问题的pippython3.6 -m pip uninstall pip# 安装兼容版本的pipcurl https://bootstrap.pypa.io/pip/3.6/get-pip.py -o get-pip.pypython3.6 get-pip.py\n\n升级 pip 到最新的版本后进行配置：\npython3 -m pip install -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple --upgrade pip#设置默认pip config set global.index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple\n\n4. 使用 pip 安装 Jupyter Notebook使用 pip3 安装 Jupyter Notebook：\nsudo pip3 install jupyter notebooksudo chown -R $USER:$USER /usr/local/share/jupyter\n\n5. 配置 Jupyter Notebook生成 Jupyter 配置文件：\njupyter notebook --generate-config\n\n创建 Jupyter Notebook 密码（会生成加密后的密码）：\njupyter notebook password\n\n6. 创建 Systemd 服务为了方便管理 Jupyter Notebook 服务，创建一个 systemd 服务文件：\nsudo nano /etc/systemd/system/jupyter.service\n\n在文件中添加以下内容：\n[Unit]Description=Jupyter NotebookAfter=network.target[Service]User=your_username  # 替换为你的用户名Group=your_username  # 替换为你的用户名WorkingDirectory=/home/your_username  # 替换为你的主目录ExecStart=/usr/local/bin/jupyter notebook --config=/home/your_username/.jupyter/jupyter_notebook_config.py[Install]WantedBy=multi-user.target\n\n7. 启动 Jupyter Notebook 服务重载 systemd 管理器配置：\nsudo systemctl daemon-reload\n\n启动 Jupyter Notebook 服务：\nsudo systemctl start jupyter\n\n设置开机自启动：\nsudo systemctl enable jupyter\n\n8. 配置防火墙如果服务器启用了防火墙，需要开放 Jupyter Notebook 默认端口（8888）：\nsudo ufw allow 8888\n\n9. 配置# 1. 备份并重新生成配置文件cp ~/.jupyter/jupyter_notebook_config.py ~/.jupyter/jupyter_notebook_config.py.bakjupyter notebook --generate-config --allow-root# 2. 设置密码jupyter notebook password# 3. 修改配置文件nano ~/.jupyter/jupyter_notebook_config.py\n\nc.NotebookApp.ip = &#x27;0.0.0.0&#x27; #your_server_ipc.NotebookApp.open_browser = Falsec.NotebookApp.port = 8888c.NotebookApp.root_dir = &#x27;/path/to/your/directory&#x27;c.ServerApp.allow_origin = &#x27;*&#x27;  # 允许所有域名访问c.ServerApp.allow_credentials = Truec.ServerApp.disable_check_xsrf = True  # 禁用XSRF保护（谨慎使用）在配置文件中添加 / 修改以下行：\n\n验证# 检查服务状态sudo systemctl status jupyter# 查看日志journalctl -u jupyter -f\n\n10. 访问 Jupyter Notebook在浏览器中访问：http://your_server_ip:8888\n\n输入之前设置的密码，即可登录 Jupyter Notebook。\n注意事项\n建议使用 HTTPS 访问 Jupyter Notebook，可以通过配置 SSL 证书实现。\n可以修改 Jupyter 配置文件（~&#x2F;.jupyter&#x2F;jupyter_notebook_config.py）来自定义更多选项，如监听地址、端口等。\n如果需要在后台运行 Jupyter Notebook，可以使用nohup命令或配置为服务。\n\n如果安装过程中遇到权限问题，可能需要使用sudo -H pip3 install jupyter来确保正确安装。\n","categories":["AI"],"tags":["jupyter-notebook"]},{"title":"Hexo Next","url":"/posts/2025/07/hexo-next/","content":"安装一、安装 Hexo 环境安装 Node.js\nhttps://deb.nodesource.com/setup_16.x — Node.js 16 “Gallium” (deprecated)\nhttps://deb.nodesource.com/setup_18.x — Node.js 18 “Hydrogen” (Maintenance)\nhttps://deb.nodesource.com/setup_19.x — Node.js 19 “Nineteen” (deprecated)\nhttps://deb.nodesource.com/setup_20.x — Node.js 20 LTS “Iron” (recommended)\nhttps://deb.nodesource.com/setup_21.x — Node.js 21 “Iron” (current)\n\ncurl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -  # 推荐20.x  sudo apt install -y nodejsnode -v  # 验证版本≥20\n\n\n二、创建 Hexo 博客安装 Hexo CLIsudo npm install hexo-cli -ghexo -v  # 验证安装\n\n创建 Hexo 博客hexo init myblog &amp;&amp; cd myblognpm install  # 安装依赖\n\n安装 Next 主题git clone https://github.com/next-theme/hexo-theme-next themes/next\n\n三、配置 Next 主题修改 Hexo 主配置编辑nano _config.yml：\n# 基本信息title: XXX’s Blogsubtitle: &#x27;&#x27;author: XXXlanguage: zh-CNtimezone: Asia/Shanghai# 主题设置theme: next# URL设置（替换为你的域名）url: http://XXX# 永久链接格式permalink: posts/:year/:month/:title/# 部署配置（后续使用Nginx部署） deploy:  type: rsync  host: XXX  user: root  root: /var/www/myblog  port: 22  delete: true  verbose: true  ignore_errors: false  args: --exclude=.DS_Store --exclude=*.tmp  # 排除临时文件  timeout: 60  # 增加超时时间\n\n  本地测试运行‌\nhexo c &amp;&amp; hexo g &amp;&amp; hexo s\n\n访问 http://localhost:4000 检查主题生效\n自定义 Next 主题编辑nano themes&#x2F;next&#x2F;_config.yml：\n# 主题风格（可选Muse/Mist/Pisces/Gemini）scheme: Gemini# 菜单配置menu:  home: / || home  archives: /archives/ || archive  categories: /categories/ || th  tags: /tags/ || tags  about: /about/ || user  search: /search/ || search# 侧边栏配置sidebar:  position: left  display: always# 社交链接social:  GitHub: https://github.com/your_username || github  Twitter: https://twitter.com/your_username || twitter  LinkedIn: https://linkedin.com/in/your_username || linkedin# 评论系统（示例：使用Gitalk）comments:  active: gitalk  gitalk:    clientID: your_client_id    clientSecret: your_client_secret    repo: your_repo    owner: your_username    admin: [&#x27;your_username&#x27;]\n\nhexo new page categorieshexo new page tagshexo new page about\n\n四、安装并配置 Nginx安装 Nginxsudo apt updatesudo apt install nginx -ysudo systemctl start nginxsudo systemctl enable nginx\n\n配置 Nginx 虚拟主机创建配置文件：\nsudo nano /etc/nginx/sites-available/myblog\n\n  添加以下内容（替换为你的域名）：\n server &#123;    listen 80;    server_name  XXX;  # 替换为你的域名    root /var/www/myblog;    index index.html index.htm;    location / &#123;        try_files $uri $uri/ /index.html;        gzip on;        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;    &#125;&#125;\n\n启用配置：\nsudo ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled/sudo nginx -t  # 验证配置\n\n五、部署手动部署npm install hexo-deployer-rsync --save# 使用sudo以root权限创建目录sudo mkdir -p /var/www/myblog# 修改目录所有者为当前用户（如ubuntu）sudo chown -R ubuntu:www-data /var/www/myblog# 设置适当的权限sudo chmod -R 755 /var/www/myblog  hexo d # 将文件复制到/var/www/html/（根据deploy配置）\n\n六、 优化头像编辑nano themes&#x2F;next&#x2F;_config.yml：\nfavicon:  small: /images/favicon.png  # 小图标（16x16）  medium: /images/favicon.png  # 中图标（32x32）  apple_touch_icon: /images/favicon.png  # Apple 设备图标  safari_pinned_tab: /images/favicon.png  # Safari 固定标签页图标  #small: /images/favicon-16x16-next.png  #medium: /images/favicon-32x32-next.png  #apple_touch_icon: /images/apple-touch-icon-next.png  #safari_pinned_tab: /images/logo.svg  #android_manifest: /manifest.json\n\n把头像文件放在 myblog&#x2F;source&#x2F;images 下\n打赏# Donate (Sponsor) settings# Front-matter variable (nonsupport animation).reward_settings:  # If true, a donate button will be displayed in every article by default.  enable: true  animation: truereward:  wechatpay: /images/wechatpay.png  #alipay: /images/alipay.png  #paypal: /images/paypal.png  #bitcoin: /images/bitcoin.png\n\n把图片文件放在 myblog&#x2F;themes&#x2F;next&#x2F;source&#x2F;images 下\nHexo NexT 本地搜索npm install hexo-generator-searchdb --save\n\n配置站点文件\n编辑 myblog&#x2F;themes&#x2F;next 下配置文件 _config.yml，新增以下内容：\nsearch:path: search.xmlfield: postformat: htmllimit: 10000\n\n配置主题文件\n编辑主题配置文件 _config.yml，启用本地搜索功能：\n# Local search# Dependencies: https://github.com/next-theme/hexo-generator-searchdblocal_search:enable: true\n\n禁用 Algolia 搜索\n如果 Algolia 搜索和本地搜索同时启用，可能会导致冲突。可以在主题配置文件中禁用 Algolia 搜索：\nalgolia_search:enable: false\n\n完成以上步骤后，重新生成并部署站点：\nhexo clean &amp;&amp; hexo g &amp;&amp; hexo d &amp;&amp; hexo s\n\n这样就可以在 Hexo 的 NexT 主题中使用本地搜索功能了\n懒加载编辑 nano themes&#x2F;next&#x2F;_config.yml：\nlazyload: true\n\n图片懒加载\nnpm install hexo-lazyload-image --save\n\n编辑 nano _config.yml：\nlazyload:  enable: true  # 启用懒加载  onlypost: false  # 是否只对文章中的图片生效  loadingImg: &quot;&quot;  # 自定义加载中的占位图路径  errorImg: &quot;&quot;  # 图片加载失败时显示的图片路径  quality: 80  # 图片质量（仅对生成的响应式图片有效）\n\n增加站点访客、文章阅读量、字符统计、阅读时间统计与对应词条翻译字符统计、阅读时间统计npm install hexo-symbols-count-time --save\n\n编辑 nano _config.yml：\nsymbols_count_time:  symbols: true                # 文章字数统计  time: true                   # 文章阅读时长  total_symbols: true          # 站点总字数统计  total_time: true             # 站点总阅读时长  exclude_codeblock: false     # 排除代码字数统计\n\n编辑 nano themes&#x2F;next&#x2F;_config.yml：\n# Post wordcount display settings# Dependencies: https://github.com/next-theme/hexo-word-countersymbols_count_time:  separated_meta: false  item_text_total: true\n\n分类和标签生成分类页面\nhexo new page &quot;categories&quot;\n\n生成后，编辑 source&#x2F;categories&#x2F;index.md 文件，添加以下内容：\n---title: 分类date: YYYY-MM-DD HH:MM:SStype: &quot;categories&quot;layout: &quot;categories&quot;---\n\n生成标签页面\nhexo new page &quot;tags&quot;\n\n生成后，编辑 source&#x2F;tags&#x2F;index.md 文件，添加以下内容：\n---title: 标签date: YYYY-MM-DD HH:MM:SStype: &quot;tags&quot;layout: &quot;tags&quot;---\n\n在菜单中添加链接编辑主题配置文件 themes&#x2F;next&#x2F;_config.yml，找到 menu 字段，添加分类和标签的菜单链接：\nmenu:  home: / || home  categories: /categories/ || th-large  # th-large 是 Font Awesome 图标类名  tags: /tags/ || tags\n\n在撰写文章时，通过 Front-matter 配置分类和标签：\n---title: &quot;Hexo Next 主题配置指南&quot;date: 2025-07-02 10:00:00categories: 技术 # 分类（可多层级，如 &quot;技术/Hexo&quot;）tags:- Hexo- Next主题- 博客搭建---文章内容...\n\n多层级分类示例：categories: 技术&#x2F;博客&#x2F;Hexo，会生成层级结构 技术 &gt; 博客 &gt; Hexo。标签格式：可使用数组格式（如上）或逗号分隔（如 tags: Hexo, Next主题, 博客搭建）。\nHexo 分页设置在 Hexo 中设置分页可以让你的博客更易于浏览。你可以通过修改配置文件 _config.yml 来实现分页功能。\n示例\n首先，确保你已经安装了必要的插件：\nnpm install hexo-generator-index --savenpm install hexo-generator-archive --savenpm install hexo-generator-tag --save\n\n然后，在你的主题配置文件 _config.yml 中进行如下修改：\n# 主页每页显示文章数index_generator:per_page: 5# 归档分页每页显示文章数archive_generator:per_page: 5# 标签分页每页显示文章数tag_generator:per_page: 10# 分类分页每页显示文章数category_generator:per_page: 10\n\n注意事项\n插件安装：确保你已经安装了 hexo-generator-index、hexo-generator-archive 和 hexo-generator-tag 插件。\n配置文件：在 _config.yml 文件中正确设置 per_page 参数，以控制每页显示的文章数量。\n通过以上步骤，你可以轻松地在 Hexo 博客中实现分页功能，使你的博客更加整洁和易于导航\n主题设置知识共享NexT 支持在侧边栏和帖子中显示 Creative Commons 4.0 International License，包括 by 、 、 by-nc by-nc-nd 、 by-nc-sa by-nd by-sa 和 cc-zero 。这些许可证允许创建者告知他们保留了哪些权利，以及他们为了接收者或其他创建者的利益而放弃了哪些权利。\n您可以通过编辑 NexT 配置文件中 section 中的 creative_commons 值来配置它，例如：\n# Creative Commons 4.0 International License.# See: https://creativecommons.org/about/cclicenses/creative_commons:  # Available values: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | cc-zero  license: by-nc-sa  # Available values: big | small  size: big  sidebar: true  post: false  # You can set a language value if you prefer a translated version of CC license, e.g. deed.zh  # CC licenses are available in 39 languages, you can find the specific and correct abbreviation you need on https://creativecommons.org  language: deed.zh-hans\n\n将值 badges 设置为 true 显示 NexT 配置文件 menu_settings 中菜单项中 Posts &#x2F; Categories &#x2F; Tags 的计数，如下所示\nNexT 配置文件\n# Enable / Disable menu icons / item badges.menu_settings:  icons: true  badges: true\n\n返回页首\nNexT 配置文件\n back2top:  enable: true  # Back to top in sidebar.  sidebar: false  # Scroll percent label in b2t button.  scrollpercent: true\n\nGitHub 横幅NexT 在右上角提供 Follow me on GitHub 横幅。\nNexT 配置文件\n# Follow me on GitHub banner in right-top corner.github_banner:  enable: true  permalink: https://github.com/yourname\n\n\n参考：theme-next\n\n","categories":["Hexo"],"tags":["hexo-next"]},{"title":"Mark Down","url":"/posts/2025/07/markdown/","content":"教程这是一篇讲解如何正确使用 Markdown 的排版示例，学会这个很有必要，能让你的文章有更佳清晰的排版。\n\n引用文本：Markdown is a text formatting syntax.\n\n语法指导普通内容这段内容展示了在内容里面一些排版格式，比如：\n\n加粗 - **加粗**\n倾斜 - *倾斜*\n删除线 - ~~删除线~~\nCode 标记 - `Code 标记`\n超级链接 - [超级链接](https://www.lddgo.net/string/markdown-editor)\nusername@gmail.com - [username@gmail.com](mailto:username@gmail.com)\n\n\n\n大标题 - Heading 3你可以选择使用 H1 至 H6，使用 ##(N) 打头。\n\nNOTE: 别忘了 # 后面需要有空格！\n\nHeading 4Heading 5Heading 6图片![alt 文本](http://image-path.png)![alt 文本](http://image-path.png &quot;图片 Title 值&quot;)\n\n代码块普通*emphasize*    **strong**_emphasize_    __strong__var a = 1\n\n语法高亮支持如果在 &#96;&#96;&#96; 后面跟随语言名称，可以有语法高亮的效果哦，比如:\n演示 Go 代码高亮package mainimport &quot;fmt&quot;func main() &#123; fmt.Println(&quot;Hello, 世界&quot;)&#125;\n\n演示 Java 高亮public class HelloWorld &#123;    public static void main(String[] args) &#123;        System.out.println(&quot;Hello World!&quot;);    &#125;&#125;\n\n\nTip: 语言名称支持下面这些: ruby, python, js, html, erb, css, coffee, bash, json, yml, xml …\n\n有序、无序、任务列表无序列表\nJava\nSpring\nIoC\nAOP\n\n\n\n\nGo\ngofmt\nWide\n\n\nNode.js\nKoa\nExpress\n\n\n\n有序列表\nNode.js\nExpress\nKoa\nSails\n\n\nGo\ngofmt\nWide\n\n\nJava\nLatke\nIDEA\n\n\n\n任务列表\n 发布 任务1\n 发布 任务2\n 预约 任务2\n\n表格如果需要展示数据什么的，可以选择使用表格。\n\n\n\nheader 1\nheader 2\n\n\n\ncell 1\ncell 2\n\n\ncell 3\ncell 4\n\n\ncell 5\ncell 6\n\n\n隐藏细节\n这里是摘要部分。\n这里是细节部分。\n\n\n段落空行可以将内容进行分段，便于阅读。（这是第一段）\n使用空行在 Markdown 排版中相当重要。（这是第二段）\n链接引用链接文本\nLDDGO.NET\n[链接文本](链接地址)\n\n数学公式\n设置\n编辑 nano /themes/next/_config.yml\n\nmathjax:  enable: true  # Available values: none | ams | all  tags: none\n\n编辑 nano markdown.md\n---title: Markdownauthor: Ma Jiangdate: 2025-07-02 16:04:08tags: Markdownmathjax: true---\n\n\n\n多行公式块：\n$$\\frac{1}{  \\Bigl(\\sqrt{\\phi \\sqrt{5}}-\\phi\\Bigr) e^{  \\frac25 \\pi}} &#x3D; 1+\\frac{e^{-2\\pi}} {1+\\frac{e^{-4\\pi}} {    1+\\frac{e^{-6\\pi}}    {1+\\frac{e^{-8\\pi}}{1+\\cdots}}  }}$$\n行内公式：\n公式 $a^2 + b^2 &#x3D; color{red}c^2$ 是行内。\n脑图Mermaid | Tutorials\n\n设置\n\nNexT config file\n# Mermaid tagmermaid:  enable: true# Available themes: default | dark | forest | neutral  theme:    light: default    dark: dark\n\nHexo config file\nhighlight:  exclude_languages:    - mermaid\n\nUsage\n&#123;% mermaid type %&#125;&#123;% endmermaid %&#125;\n\nor\n`` `  mermaid  type`` `\n\n\n\nmindmap\n    Root\n        教程\n          语法指导\n            普通内容\n            大标题  Heading 3\n              Heading 4\n                Heading 5\n                  Heading 6\n            图片\n            代码块\n              普通\n              语法高亮支持\n                演示 Go 代码高亮\n                演示 Java 高亮\n            有序、无序、任务列表\n              无序列表\n              有序列表\n              任务列表\n            表格\n            隐藏细节\n            段落\n            链接引用\n            数学公式\n            脑图\n            流程图\n            时序图\n            甘特图\n            图表\n            五线谱\n            Graphviz\n            脚注\n\n流程图graph TB\n    c1--&gt;a2\n    subgraph one\n    a1--&gt;a2\n    end\n    subgraph two\n    b1--&gt;b2\n    end\n    subgraph three\n    c1--&gt;c2\n    end\n\n时序图sequenceDiagram\n    Alice-&gt;&gt;John: Hello John, how are you?\n    loop Every minute\n        John--&gt;&gt;Alice: Great!\n    end\n\n甘特图gantt\n    title A Gantt Diagram\n    dateFormat  YYYY-MM-DD\n    section Section\n    A task           :a1, 2019-01-01, 30d\n    Another task     :after a1  , 20d\n    section Another\n    Task in sec      :2019-01-12  , 12d\n    another task      : 24d\n\n图表饼图\npie title Pets adopted by volunteers\n    &quot;Dogs&quot; : 386\n    &quot;Cats&quot; : 85\n    &quot;Rats&quot; : 15\n\n\nFlowchartflowchart\n    A[Start] --&gt; B[Your Operation]\n    A --No --&gt;C\n    B --&gt; C&#123;Yes or No？&#125;\n    C --Yes --&gt; D[End]\n\nGraphviz\n设置\n\nhexo-graphviz\nPlugin for Hexo which renders Graphviz plots\nInstallation\nInstall Package\nnpm install hexo-graphviz --save\n\nEdit Config\nAfter installed, you should edit hexo config file: _config.yml:\n# hexo-graphvizgraphviz:    enable: true\n\nInclude viz.js in njk\nAfter editing _config.yml, you shoud be able to edit your blog page component like after-footer.ejs or a njk file which can be found inside the themes&#x2F;layout&#x2F;_partials&#x2F; directory.\nThe following code should be added in the file footer.njk:\n&#123;% if theme.graphviz.enable %&#125;  &lt;script src=&#x27;https://cdnjs.cloudflare.com/ajax/libs/viz.js/1.7.1/viz.js&#x27;&gt;&lt;/script&gt;  &lt;script&gt;    String.prototype.replaceAll = function(search, replacement) &#123;      var target = this;      return target.split(search).join(replacement);    &#125;;    let vizObjects = document.querySelectorAll(&#x27;.graphviz&#x27;)    for (let item of vizObjects) &#123;      let svg = undefined      try &#123;        svg = Viz(item.textContent.replaceAll(&#x27;–&#x27;, &#x27;--&#x27;), &#x27;svg&#x27;)      &#125; catch(e) &#123;        svg = `&lt;pre class=&quot;error&quot;&gt;$&#123;e&#125;&lt;/pre&gt;`      &#125;      item.outerHTML = svg    &#125;  &lt;/script&gt;&#123;% endif %&#125;\n\nUsage\nThe graphviz block can be written inside a graphviz codeblock.\ndigraph finite_state_machine &#123;    rankdir=LR;    size=&quot;8,5&quot;    node [shape = doublecircle]; S;    node [shape = point ]; qi    node [shape = circle];    qi -&gt; S;    S  -&gt; q1 [ label = &quot;a&quot; ];    S  -&gt; S  [ label = &quot;a&quot; ];    q1 -&gt; S  [ label = &quot;a&quot; ];    q1 -&gt; q2 [ label = &quot;ddb&quot; ];    q2 -&gt; q1 [ label = &quot;b&quot; ];    q2 -&gt; q2 [ label = &quot;b&quot; ];&#125;\n\n\n\ndigraph finite_state_machine &#123;    rankdir=LR;    size=&quot;8,5&quot;    node [shape = doublecircle]; S;    node [shape = point ]; qi    node [shape = circle];    qi -&gt; S;    S  -&gt; q1 [ label = &quot;a&quot; ];    S  -&gt; S  [ label = &quot;a&quot; ];    q1 -&gt; S  [ label = &quot;a&quot; ];    q1 -&gt; q2 [ label = &quot;ddb&quot; ];    q2 -&gt; q1 [ label = &quot;b&quot; ];    q2 -&gt; q2 [ label = &quot;b&quot; ];&#125;\n\n五线谱\n设置\n\nhexo-tag-abcjs\nHelps you to render standard music notation with abcjs on your blog posts\nInstall\nnpm install --save hexo-tag-abcjs\n\nConfigurationYou can configure this plugin in _config.yml.\nabcjs:  js: &#x27;/js/abcjs_midi_5.9.1-min.js&#x27;,  css: &#x27;/css/abcjs-midi.css&#x27;,  midi: true,  animation: true,  animationColors: [&#x27;#000000&#x27;, &#x27;#3d9afc&#x27;]  options: &#123;    startingTune: 0,    print: false,    visualTranspose: 0,    scale: 1,    responsive: &#x27;resize&#x27;,    inlineControls: &#123;      loopToggle: true,      standard: true,      tooltipLoop: &#x27;Click to toggle play once/repeat.&#x27;,      tooltipReset: &#x27;Click to go to beginning.&#x27;,      tooltipPlay: &#x27;Click to play/pause.&#x27;,      tooltipProgress: &#x27;Click to change the playback position.&#x27;    &#125;  &#125;,  scriptId: &#x27;hexo-tag-abcjs&#x27;\n\n\njs - The abcjs library url. default: &#x2F;js&#x2F;abcjs_midi_5.9.1-min.js\ncss - The abcjs style url. default: &#x2F;css&#x2F;abcjs-midi.css\nmidi - Whether enable midi audio. default: true\nanimation - Whether enable absjs animation. When true, highlights the current notation. default: true\nanimationColors - The animated notation color. default: [‘#000000’, ‘#3d9afc’]\noptions - The abcjs Configuration. default as above\nscriptId - The id of inserted script tag. default: hexo-tag-abcjs\n\nUsage\n&#123;% abcjs [autoplay] [no-midi] [no-animation] %&#125;here is your abcString&#123;% endabcjs %&#125;\n\n\nautoplay - Enable autoplay\nno-midi - Disabled midi audio\nno-animation - Disabled audio animation\n\nExampleThe following is a simple demo:\n&#123;% abcjs autoplay %&#125;X: 22T:Money LostM:3/4L:1/8Q:1/4=100C:Paul RosenS:Copyright 2007, Paul RosenR:KlezmerK:DmAde|:&quot;Dm&quot;(f2d)e gf|&quot;A7&quot;e2^c4|&quot;Gm&quot;B&gt;&gt;^c BA BG|&quot;A&quot;A3Ade|&quot;Dm&quot;(f2d)e gf|&quot;A7&quot;e2^c4|&quot;Gm&quot;A&gt;&gt;B &quot;A7&quot;AG FE|1&quot;Dm&quot;D3Ade:|2&quot;Dm&quot;D3DEF||:&quot;Gm&quot;(G2D)E FG|&quot;Dm&quot;A2F4|&quot;Gm&quot;B&gt;&gt;c &quot;A7&quot;BA BG|&quot;Dm&quot;A3 DEF|&quot;Gm&quot;(G2D)EFG|&quot;Dm&quot;A2F4|&quot;E°&quot;E&gt;&gt;Fy &quot;(A7)&quot;ED^C2|1&quot;Dm&quot;D3DEF:|2&quot;Dm&quot;D6||&#123;% endabcjs %&#125;\n\n\n\nX: 24T: Clouds ThickenC: Paul RosenS: Copyright 2005, Paul RosenM: 6/8L: 1/8Q: 3/8=116R: Creepy JigK: Em|:&quot;Em&quot;EEE E2G|&quot;C7&quot;_B2A G2F|&quot;Em&quot;EEE E2G|&quot;C7&quot;_B2A &quot;B7&quot;=B3|&quot;Em&quot;EEE E2G|&quot;C7&quot;_B2A G2F|&quot;Em&quot;GFE &quot;D (Bm7)&quot;F2D|1&quot;Em&quot;E3-E3:|2&quot;Em&quot;E3-E2B|:&quot;Em&quot;e2e gfe|&quot;G&quot;g2ab3|&quot;Em&quot;gfeg2e|&quot;D&quot;fedB2A|&quot;Em&quot;e2e gfe|&quot;G&quot;g2ab3|&quot;Em&quot;gfe&quot;D&quot;f2d|&quot;Em&quot;e3-e3:|\n\n脚注这里是一个脚注引用^1，这里是另一个脚注引用^bignote。\n缩进对齐的段落包含在这个脚注定义内。\n可以使用代码块。\n\n还有其他行级排版语法，比如加粗和链接。\n这里是一个脚注引用[^1]，这里是另一个脚注引用[^bignote]。[^1]: 第一个脚注定义。[^bignote]: 脚注定义可使用多段内容。    缩进对齐的段落包含在这个脚注定义内。    ` ``    可以使用代码块。    ` ``    还有其他行级排版语法，比如**加粗**和[链接](https://lddgo.net)。\n","categories":["Markdown"],"tags":["mark-down"]},{"title":"Deepseek Vllm Ragflow","url":"/posts/2025/07/vllm-ragflow/","content":"在 Ubuntu 22.04 上部署 Docker + Deepseek + VLLM + RAGFlow 优化流程架构说明graph LR\nA[vLLM 推理引擎] --&gt;|提供API服务| B(RAGFlow)\nC[DeepSeek 大模型] --&gt;|嵌入/生成能力| A\nD[企业知识库] --&gt;|文档解析| B\nB --&gt;|精准问答| E[终端应用]\n\n前置条件\n\n建议配置：至少 16GB 内存，GPU 显存 ≥ 10GB（推荐 NVIDIA RTX 3090&#x2F;4090 或 A100）\n已安装 NVIDIA 驱动（版本 ≥ 525，支持 CUDA 12.0+）\n系统预留 ≥ 50GB 存储空间（用于模型缓存和数据存储）\n\n\n1. 安装 Docker 及相关工具1.1 依赖与密钥配置\nsudo apt update &amp;&amp; sudo apt upgrade -ysudo apt install -y ca-certificates curl gnupg lsb-release# 创建密钥存储目录sudo install -m 0755 -d /etc/apt/keyrings# 添加 Docker 官方 GPG 密钥curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpgsudo chmod a+r /etc/apt/keyrings/docker.gpg\n\n1.2 配置 Docker 源并安装\n# 添加 Docker 软件源echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null# 安装 Docker 组件sudo apt updatesudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin# 添加当前用户到 docker 组（避免每次使用 sudo）sudo usermod -aG docker $USER &amp;&amp; newgrp docker\n\n1.3 配置 Docker 镜像加速（关键优化）\nsudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;&#123;  &quot;registry-mirrors&quot;: [    &quot;https://docker.registry.cyou&quot;,    &quot;https://mirror.aliyuncs.com&quot;,    &quot;https://dockerproxy.com&quot;,    &quot;https://docker.mirrors.ustc.edu.cn&quot;  ],  &quot;default-runtime&quot;: &quot;nvidia&quot;,  # 默认启用 NVIDIA 运行时  &quot;runtimes&quot;: &#123;    &quot;nvidia&quot;: &#123;      &quot;path&quot;: &quot;nvidia-container-runtime&quot;,      &quot;runtimeArgs&quot;: []    &#125;  &#125;&#125;EOF\n\n# 重启 Docker 服务sudo systemctl daemon-reloadsudo systemctl restart docker\n\n1.4 验证 Docker 安装\n# 验证基础功能sudo docker run --rm hello-world# 验证 GPU 支持（若使用 GPU）sudo docker run --rm --gpus all swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/nvidia/cuda:12.9.1-base-ubuntu22.04  nvidia-smi# 若成功输出 GPU 信息，则说明 GPU 配置正常\n\n\n参考： 渡渡鸟镜像\n\n\n\n2. 配置 NVIDIA 容器工具包（如果使用 GPU）添加 NVIDIA 容器工具包的软件源：\n# 添加 NVIDIA 源distribution=$(. /etc/os-release;echo $ID$VERSION_ID)curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list# 安装工具包sudo apt updatesudo apt install -y nvidia-container-toolkit nvidia-container-runtime# 重启 Docker 使配置生效sudo systemctl restart docker\n\n3. 部署服务（Docker Compose）Ragflow\nragflow\n\ngit clone https://gitee.com/infiniflow/ragflow.gitgit branch -agit checkout -b v0.19 origin/0.19cd ragflow/docker\n\n3.1 docker-compose.yml（核心配置）\n本地文件结构\n你的项目目录/├── README.md├── docker-compose-CN-oc9.yml├── docker-compose-base.yml├── docker-compose-gpu-CN-oc9.yml├── docker-compose-gpu.yml├── docker-compose-macos.yml├── docker-compose.yml  # 你的docker-compose配置文件├── entrypoint.sh├── infinity_conf.toml├── init.sql├── launch_backend_service.sh├── nginx│   ├── nginx.conf│   ├── proxy.conf│   └── ragflow.conf├── ragflow-logs└── service_conf.yaml.template\n\nnano .env\n\n\n.env\n\n# The type of doc engine to use.# Available options:# - `elasticsearch` (default)# - `infinity` (https://github.com/infiniflow/infinity)# - `opensearch` (https://github.com/opensearch-project/OpenSearch)DOC_ENGINE=$&#123;DOC_ENGINE:-elasticsearch&#125;# ------------------------------# docker env var for specifying vector db type at startup# (based on the vector db type, the corresponding docker# compose profile will be used)# ------------------------------COMPOSE_PROFILES=$&#123;DOC_ENGINE&#125;# The version of Elasticsearch.STACK_VERSION=8.11.3# The hostname where the Elasticsearch service is exposedES_HOST=es01# The port used to expose the Elasticsearch service to the host machine,# allowing EXTERNAL access to the service running inside the Docker container.ES_PORT=1200# The password for Elasticsearch.ELASTIC_PASSWORD=infini_rag_flow# the hostname where OpenSearch service is exposed, set it not the same as elasticsearchOS_PORT=1201# The hostname where the OpenSearch service is exposedOS_HOST=opensearch01# The password for OpenSearch.# At least one uppercase letter, one lowercase letter, one digit, and one special characterOPENSEARCH_PASSWORD=infini_rag_flow_OS_01# The port used to expose the Kibana service to the host machine,# allowing EXTERNAL access to the service running inside the Docker container.KIBANA_PORT=6601KIBANA_USER=rag_flowKIBANA_PASSWORD=infini_rag_flow# The maximum amount of the memory, in bytes, that a specific Docker container can use while running.# Update it according to the available memory in the host machine.MEM_LIMIT=8073741824# The hostname where the Infinity service is exposedINFINITY_HOST=infinity# Port to expose Infinity API to the hostINFINITY_THRIFT_PORT=23817INFINITY_HTTP_PORT=23820INFINITY_PSQL_PORT=5432# The password for MySQL.MYSQL_PASSWORD=infini_rag_flow# The hostname where the MySQL service is exposedMYSQL_HOST=mysql# The database of the MySQL service to useMYSQL_DBNAME=rag_flow# The port used to expose the MySQL service to the host machine,# allowing EXTERNAL access to the MySQL database running inside the Docker container.MYSQL_PORT=5455# The hostname where the MinIO service is exposedMINIO_HOST=minio# The port used to expose the MinIO console interface to the host machine,# allowing EXTERNAL access to the web-based console running inside the Docker container.MINIO_CONSOLE_PORT=9001# The port used to expose the MinIO API service to the host machine,# allowing EXTERNAL access to the MinIO object storage service running inside the Docker container.MINIO_PORT=9000# The username for MinIO.# When updated, you must revise the `minio.user` entry in service_conf.yaml accordingly.MINIO_USER=rag_flow# The password for MinIO.# When updated, you must revise the `minio.password` entry in service_conf.yaml accordingly.MINIO_PASSWORD=infini_rag_flow# The hostname where the Redis service is exposedREDIS_HOST=redis# The port used to expose the Redis service to the host machine,# allowing EXTERNAL access to the Redis service running inside the Docker container.REDIS_PORT=6379# The password for Redis.REDIS_PASSWORD=infini_rag_flow# The port used to expose RAGFlow&#x27;s HTTP API service to the host machine,# allowing EXTERNAL access to the service running inside the Docker container.SVR_HTTP_PORT=9380# The RAGFlow Docker image to download.# Defaults to the v0.19.0-slim edition, which is the RAGFlow Docker image without embedding models.#RAGFLOW_IMAGE=infiniflow/ragflow:v0.19.0-slim## To download the RAGFlow Docker image with embedding models, uncomment the following line instead:# RAGFLOW_IMAGE=infiniflow/ragflow:v0.19.0## The Docker image of the v0.19.0 edition includes built-in embedding models:#   - BAAI/bge-large-zh-v1.5#   - maidalun1020/bce-embedding-base_v1## If you cannot download the RAGFlow Docker image:## - For the `nightly-slim` edition, uncomment either of the following:# RAGFLOW_IMAGE=swr.cn-north-4.myhuaweicloud.com/infiniflow/ragflow:nightly-slim# RAGFLOW_IMAGE=registry.cn-hangzhou.aliyuncs.com/infiniflow/ragflow:nightly-slim## - For the `nightly` edition, uncomment either of the following:#RAGFLOW_IMAGE=swr.cn-north-4.myhuaweicloud.com/infiniflow/ragflow:nightlyRAGFLOW_IMAGE=swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/infiniflow/ragflow:v0.19.0# RAGFLOW_IMAGE=registry.cn-hangzhou.aliyuncs.com/infiniflow/ragflow:nightly# The local time zone.TIMEZONE=&#x27;Asia/Shanghai&#x27;# Uncomment the following line if you have limited access to huggingface.co:HF_ENDPOINT=https://hf-mirror.com# Optimizations for MacOS# Uncomment the following line if your operating system is MacOS:# MACOS=1# The maximum file size limit (in bytes) for each upload to your knowledge base or File Management.# To change the 1GB file size limit, uncomment the line below and update as needed.# MAX_CONTENT_LENGTH=1073741824# After updating, ensure `client_max_body_size` in nginx/nginx.conf is updated accordingly.# Note that neither `MAX_CONTENT_LENGTH` nor `client_max_body_size` sets the maximum size for files uploaded to an agent.# See https://ragflow.io/docs/dev/begin_component for details.# Log level for the RAGFlow&#x27;s own and imported packages.# Available levels:# - `DEBUG`# - `INFO` (default)# - `WARNING`# - `ERROR`# For example, the following line changes the log level of `ragflow.es_conn` to `DEBUG`:# LOG_LEVELS=ragflow.es_conn=DEBUG# aliyun OSS configuration# STORAGE_IMPL=OSS# ACCESS_KEY=xxx# SECRET_KEY=eee# ENDPOINT=http://oss-cn-hangzhou.aliyuncs.com# REGION=cn-hangzhou# BUCKET=ragflow65536# A user registration switch:# - Enable registration: 1# - Disable registration: 0REGISTER_ENABLED=1# Sandbox settings# Important: To enable sandbox, you must re-declare the compose profiles. See hints at the end of file.# Double check if you add `sandbox-executor-manager` to your `/etc/hosts`# Pull the required base images before running:#   docker pull infiniflow/sandbox-base-nodejs:latest#   docker pull infiniflow/sandbox-base-python:latest# Our default sandbox environments include:#   - Node.js base image: includes axios#   - Python base image: includes requests, numpy, and pandas# Specify custom executor images below if you&#x27;re using non-default environments.# SANDBOX_ENABLED=1# SANDBOX_HOST=sandbox-executor-manager# SANDBOX_EXECUTOR_MANAGER_IMAGE=infiniflow/sandbox-executor-manager:latest# SANDBOX_EXECUTOR_MANAGER_POOL_SIZE=3# SANDBOX_BASE_PYTHON_IMAGE=infiniflow/sandbox-base-python:latest# SANDBOX_BASE_NODEJS_IMAGE=infiniflow/sandbox-base-nodejs:latest# SANDBOX_EXECUTOR_MANAGER_PORT=9385# SANDBOX_ENABLE_SECCOMP=false# SANDBOX_MAX_MEMORY=256m # b, k, m, g# SANDBOX_TIMEOUT=10s # s, m, 1m30s# Important: To enable sandbox, you must re-declare the compose profiles.# 1. Comment out the COMPOSE_PROFILES line above.# 2. Uncomment one of the following based on your chosen document engine:#    - For Elasticsearch:# COMPOSE_PROFILES=elasticsearch,sandbox#    - For Infinity:# COMPOSE_PROFILES=infinity,sandbox#    - For OpenSearch:# COMPOSE_PROFILES=opensearch,sandbox\n\n\n\nnano docker-compose-base.yml \n\n\ndocker-compose-base.yml \n\nservices:  es01:    container_name: ragflow-es-01    profiles:      - elasticsearch    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/elasticsearch:8.11.3    volumes:      - esdata01:/usr/share/elasticsearch/data    ports:      - $&#123;ES_PORT&#125;:9200    env_file: .env    environment:      - node.name=es01      - ELASTIC_PASSWORD=$&#123;ELASTIC_PASSWORD&#125;      - bootstrap.memory_lock=false      - discovery.type=single-node      - xpack.security.enabled=true      - xpack.security.http.ssl.enabled=false      - xpack.security.transport.ssl.enabled=false      - cluster.routing.allocation.disk.watermark.low=5gb      - cluster.routing.allocation.disk.watermark.high=3gb      - cluster.routing.allocation.disk.watermark.flood_stage=2gb      - TZ=$&#123;TIMEZONE&#125;    mem_limit: $&#123;MEM_LIMIT&#125;    ulimits:      memlock:        soft: -1        hard: -1    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;curl -s http://localhost:9200 || exit 1&quot;]      interval: 10s      timeout: 10s      retries: 120    networks:      - ragflow    restart: unless-stopped  opensearch01:    container_name: ragflow-opensearch-01    profiles:      - opensearch    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/opensearchproject/opensearch:2.19.1    volumes:      - osdata01:/usr/share/opensearch/data    ports:      - $&#123;OS_PORT&#125;:9201    env_file: .env    environment:      - node.name=opensearch01      - OPENSEARCH_PASSWORD=$&#123;OPENSEARCH_PASSWORD&#125;      - OPENSEARCH_INITIAL_ADMIN_PASSWORD=$&#123;OPENSEARCH_PASSWORD&#125;      - bootstrap.memory_lock=false      - discovery.type=single-node      - plugins.security.disabled=false      - plugins.security.ssl.http.enabled=false      - plugins.security.ssl.transport.enabled=true      - cluster.routing.allocation.disk.watermark.low=5gb      - cluster.routing.allocation.disk.watermark.high=3gb      - cluster.routing.allocation.disk.watermark.flood_stage=2gb      - TZ=$&#123;TIMEZONE&#125;      - http.port=9201    mem_limit: $&#123;MEM_LIMIT&#125;    ulimits:      memlock:        soft: -1        hard: -1    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;curl -s http://localhost:9201 || exit 1&quot;]      interval: 10s      timeout: 10s      retries: 120    networks:      - ragflow    restart: unless-stopped  infinity:    container_name: ragflow-infinity    profiles:      - infinity    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/infiniflow/infinity:v0.6.0-dev3    volumes:      - infinity_data:/var/infinity      - ./infinity_conf.toml:/infinity_conf.toml    command: [&quot;-f&quot;, &quot;/infinity_conf.toml&quot;]    ports:      - $&#123;INFINITY_THRIFT_PORT&#125;:23817      - $&#123;INFINITY_HTTP_PORT&#125;:23820      - $&#123;INFINITY_PSQL_PORT&#125;:5432    env_file: .env    environment:      - TZ=$&#123;TIMEZONE&#125;    mem_limit: $&#123;MEM_LIMIT&#125;    ulimits:      nofile:        soft: 500000        hard: 500000    networks:      - ragflow    healthcheck:      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:23820/admin/node/current&quot;]      interval: 10s      timeout: 10s      retries: 120    restart: unless-stopped  sandbox-executor-manager:    container_name: ragflow-sandbox-executor-manager    profiles:      - sandbox    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/infiniflow/sandbox-executor-manager:latest    privileged: true    ports:      - $&#123;SANDBOX_EXECUTOR_MANAGER_PORT&#125;:9385    env_file: .env    volumes:      - /var/run/docker.sock:/var/run/docker.sock    networks:      - ragflow    security_opt:      - no-new-privileges:true    environment:      - TZ=$&#123;TIMEZONE&#125;      - SANDBOX_EXECUTOR_MANAGER_POOL_SIZE=$&#123;SANDBOX_EXECUTOR_MANAGER_POOL_SIZE:-3&#125;      - SANDBOX_BASE_PYTHON_IMAGE=$&#123;SANDBOX_BASE_PYTHON_IMAGE:-infiniflow/sandbox-base-python:latest&#125;      - SANDBOX_BASE_NODEJS_IMAGE=$&#123;SANDBOX_BASE_NODEJS_IMAGE:-infiniflow/sandbox-base-nodejs:latest&#125;      - SANDBOX_ENABLE_SECCOMP=$&#123;SANDBOX_ENABLE_SECCOMP:-false&#125;      - SANDBOX_MAX_MEMORY=$&#123;SANDBOX_MAX_MEMORY:-256m&#125;      - SANDBOX_TIMEOUT=$&#123;SANDBOX_TIMEOUT:-10s&#125;    healthcheck:      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:9385/healthz&quot;]      interval: 10s      timeout: 5s      retries: 5    restart: unless-stopped  mysql:    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/mysql:8.0.39    container_name: ragflow-mysql    env_file: .env    environment:      - MYSQL_ROOT_PASSWORD=$&#123;MYSQL_PASSWORD&#125;      - TZ=$&#123;TIMEZONE&#125;    command:      --max_connections=1000      --character-set-server=utf8mb4      --collation-server=utf8mb4_unicode_ci      --default-authentication-plugin=mysql_native_password      --tls_version=&quot;TLSv1.2,TLSv1.3&quot;      --init-file /data/application/init.sql      --binlog_expire_logs_seconds=604800    ports:      - $&#123;MYSQL_PORT&#125;:3306    volumes:      - mysql_data:/var/lib/mysql      - ./init.sql:/data/application/init.sql    networks:      - ragflow    healthcheck:      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-uroot&quot;, &quot;-p$&#123;MYSQL_PASSWORD&#125;&quot;]      interval: 10s      timeout: 10s      retries: 3    restart: unless-stopped  minio:    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/quay.io/minio/minio:RELEASE.2023-12-20T01-00-02Z    container_name: ragflow-minio    command: server --console-address &quot;:9001&quot; /data    ports:      - $&#123;MINIO_PORT&#125;:9000      - $&#123;MINIO_CONSOLE_PORT&#125;:9001    env_file: .env    environment:      - MINIO_ROOT_USER=$&#123;MINIO_USER&#125;      - MINIO_ROOT_PASSWORD=$&#123;MINIO_PASSWORD&#125;      - TZ=$&#123;TIMEZONE&#125;    volumes:      - minio_data:/data    networks:      - ragflow    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;timeout 5 bash -c &#x27;echo -n &gt; /dev/tcp/localhost/9000&#x27; &amp;&amp; exit 0 || exit 1&quot;]      interval: 10s      timeout: 5s      retries: 8      start_period: 15s    restart: unless-stopped  redis:    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/valkey/valkey:8    container_name: ragflow-redis    command: redis-server --requirepass $&#123;REDIS_PASSWORD&#125; --maxmemory 128mb --maxmemory-policy allkeys-lru    env_file: .env    ports:      - $&#123;REDIS_PORT&#125;:6379    volumes:      - redis_data:/data    networks:      - ragflow    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;redis-cli -a $&#123;REDIS_PASSWORD&#125; ping | grep -q PONG || exit 1&quot;]      interval: 10s      timeout: 5s      retries: 10      start_period: 10s    restart: unless-stoppedvolumes:  esdata01:    driver: local  osdata01:    driver: local  infinity_data:    driver: local  mysql_data:    driver: local  minio_data:    driver: local  redis_data:    driver: localnetworks:  ragflow:    driver: bridge\n\n\n\nnano docker-compose.yml \n\n\ndocker-compose.yml \n\ninclude:  - ./docker-compose-base.yml# To ensure that the container processes the locally modified `service_conf.yaml.template` instead of the one included in its image, you need to mount the local `service_conf.yaml.template` to the container.services:  # 新增 vLLM 服务  vllm:    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/vllm/vllm-openai:v0.10.0    container_name: vllm-deepseek    restart: unless-stopped  # 确保开机自动重启    command: [      &quot;--model&quot;, &quot;deepseek-ai/deepseek-coder-1.3b-instruct&quot;,      &quot;--dtype&quot;, &quot;auto&quot;,      &quot;--max-model-len&quot;, &quot;4096&quot;,      &quot;--host&quot;, &quot;0.0.0.0&quot;,      &quot;--port&quot;, &quot;8000&quot;,      &quot;--gpu-memory-utilization&quot;, &quot;0.9&quot;,      &quot;--load-format&quot;, &quot;auto&quot;,      &quot;--download-dir&quot;, &quot;/model_cache&quot;,      &quot;--max-num-batched-tokens&quot;, &quot;4096&quot;    ]    ports:      - &quot;8000:8000&quot;    deploy:      resources:        reservations:          devices:            - driver: nvidia              count: 1              capabilities: [gpu]    volumes:      - model_cache:/model_cache    environment:      - CUDA_VISIBLE_DEVICES=0      - HF_HOME=/model_cache      - HF_ENDPOINT=https://hf-mirror.com      - HF_HUB_ENABLE_HF_TRANSFER=0      - HF_HUB_NUM_RETRIES=10      - PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True    networks:      - ragflow    healthcheck:      test: [&quot;CMD-SHELL&quot;, &quot;curl -sSf http://localhost:8000/v1/models || exit 1&quot;]      interval: 30s      timeout: 10s      retries: 10      start_period: 180s  # 增加模型加载时间  ragflow:    depends_on:      mysql:        condition: service_healthy      redis:        condition: service_healthy      minio:        condition: service_healthy      es01:        condition: service_healthy      vllm:        condition: service_healthy    image: $&#123;RAGFLOW_IMAGE&#125;    container_name: ragflow-server    restart: unless-stopped  # 确保开机自动重启    ports:      - $&#123;SVR_HTTP_PORT&#125;:9380      - 80:80      - 443:443      - 5678:5678      - 5679:5679      - 9382:9382    volumes:      - ./ragflow-logs:/ragflow/logs      - ./nginx/ragflow.conf:/etc/nginx/conf.d/ragflow.conf      - ./nginx/proxy.conf:/etc/nginx/proxy.conf      - ./nginx/nginx.conf:/etc/nginx/nginx.conf      - ../history_data_agent:/ragflow/history_data_agent      - ./service_conf.yaml.template:/ragflow/conf/service_conf.yaml.template      - ./entrypoint.sh:/ragflow/entrypoint.sh    env_file: .env    environment:      - STARTUP_DELAY=60  # 增加启动延迟，确保所有依赖服务就绪      - TZ=$&#123;TIMEZONE&#125;      - HF_ENDPOINT=$&#123;HF_ENDPOINT&#125;      - MACOS=$&#123;MACOS&#125;      - VLLM_ENDPOINT=http://vllm-deepseek:8000/v1    networks:      - ragflow    extra_hosts:      - &quot;host.docker.internal:host-gateway&quot;    healthcheck:  # 添加健康检查      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:9380/api/v1/health&quot;]      interval: 30s      timeout: 10s      retries: 5      start_period: 40s# 在 volumes 部分新增volumes:  model_cache:    driver: local\n\n\n\nnano service_conf.yaml.template \n\n\nservice_conf.yaml.template \n\nragflow:  host: $&#123;RAGFLOW_HOST:-0.0.0.0&#125;  http_port: 9380mysql:  name: &#x27;$&#123;MYSQL_DBNAME:-rag_flow&#125;&#x27;  user: &#x27;$&#123;MYSQL_USER:-root&#125;&#x27;  password: &#x27;$&#123;MYSQL_PASSWORD:-infini_rag_flow&#125;&#x27;  host: &#x27;$&#123;MYSQL_HOST:-mysql&#125;&#x27;  port: 3306  max_connections: 900  stale_timeout: 300minio:  user: &#x27;$&#123;MINIO_USER:-rag_flow&#125;&#x27;  password: &#x27;$&#123;MINIO_PASSWORD:-infini_rag_flow&#125;&#x27;  host: &#x27;$&#123;MINIO_HOST:-minio&#125;:9000&#x27;es:  hosts: &#x27;http://$&#123;ES_HOST:-es01&#125;:9200&#x27;  username: &#x27;$&#123;ES_USER:-elastic&#125;&#x27;  password: &#x27;$&#123;ELASTIC_PASSWORD:-infini_rag_flow&#125;&#x27;os:  hosts: &#x27;http://$&#123;OS_HOST:-opensearch01&#125;:9201&#x27;  username: &#x27;$&#123;OS_USER:-admin&#125;&#x27;  password: &#x27;$&#123;OPENSEARCHH_PASSWORD:-infini_rag_flow_OS_01&#125;&#x27;infinity:  uri: &#x27;$&#123;INFINITY_HOST:-infinity&#125;:23817&#x27;  db_name: &#x27;default_db&#x27;redis:  db: 1  password: &#x27;$&#123;REDIS_PASSWORD:-infini_rag_flow&#125;&#x27;  host: &#x27;$&#123;REDIS_HOST:-redis&#125;:6379&#x27;model_providers:  - name: &quot;vllm&quot;    type: &quot;api&quot;    base_url: &quot;http://vllm-deepseek:8000/v1&quot;    models:      - name: &quot;deepseek-coder&quot;        model_id: &quot;deepseek-ai/deepseek-coder-1.3b-instruct&quot;        generation_config:          temperature: 0.3          max_tokens: 4096  # Should match max_model_len in vLLM config          top_p: 0.9# postgres:#   name: &#x27;$&#123;POSTGRES_DBNAME:-rag_flow&#125;&#x27;#   user: &#x27;$&#123;POSTGRES_USER:-rag_flow&#125;&#x27;#   password: &#x27;$&#123;POSTGRES_PASSWORD:-infini_rag_flow&#125;&#x27;#   host: &#x27;$&#123;POSTGRES_HOST:-postgres&#125;&#x27;#   port: 5432#   max_connections: 100#   stale_timeout: 30# s3:#   access_key: &#x27;access_key&#x27;#   secret_key: &#x27;secret_key&#x27;#   region: &#x27;region&#x27;#   endpoint_url: &#x27;endpoint_url&#x27;#   bucket: &#x27;bucket&#x27;#   prefix_path: &#x27;prefix_path&#x27;#   signature_version: &#x27;v4&#x27;#   addressing_style: &#x27;path&#x27;# oss:#   access_key: &#x27;$&#123;ACCESS_KEY&#125;&#x27;#   secret_key: &#x27;$&#123;SECRET_KEY&#125;&#x27;#   endpoint_url: &#x27;$&#123;ENDPOINT&#125;&#x27;#   region: &#x27;$&#123;REGION&#125;&#x27;#   bucket: &#x27;$&#123;BUCKET&#125;&#x27;#   prefix_path: &#x27;$&#123;OSS_PREFIX_PATH&#125;&#x27;# azure:#   auth_type: &#x27;sas&#x27;#   container_url: &#x27;container_url&#x27;#   sas_token: &#x27;sas_token&#x27;# azure:#   auth_type: &#x27;spn&#x27;#   account_url: &#x27;account_url&#x27;#   client_id: &#x27;client_id&#x27;#   secret: &#x27;secret&#x27;#   tenant_id: &#x27;tenant_id&#x27;#   container_name: &#x27;container_name&#x27;# user_default_llm:#   factory: &#x27;Tongyi-Qianwen&#x27;#   api_key: &#x27;sk-xxxxxxxxxxxxx&#x27;#   base_url: &#x27;&#x27;#   default_models:#     chat_model: &#x27;qwen-plus&#x27;#     embedding_model: &#x27;BAAI/bge-large-zh-v1.5@BAAI&#x27;#     rerank_model: &#x27;&#x27;#     asr_model: &#x27;&#x27;#     image2text_model: &#x27;&#x27;# oauth:#   oauth2:#     display_name: &quot;OAuth2&quot;#     client_id: &quot;your_client_id&quot;#     client_secret: &quot;your_client_secret&quot;#     authorization_url: &quot;https://your-oauth-provider.com/oauth/authorize&quot;#     token_url: &quot;https://your-oauth-provider.com/oauth/token&quot;#     userinfo_url: &quot;https://your-oauth-provider.com/oauth/userinfo&quot;#     redirect_uri: &quot;https://your-app.com/v1/user/oauth/callback/oauth2&quot;#   oidc:#     display_name: &quot;OIDC&quot;#     client_id: &quot;your_client_id&quot;#     client_secret: &quot;your_client_secret&quot;#     issuer: &quot;https://your-oauth-provider.com/oidc&quot;#     scope: &quot;openid email profile&quot;#     redirect_uri: &quot;https://your-app.com/v1/user/oauth/callback/oidc&quot;#   github:#     type: &quot;github&quot;#     icon: &quot;github&quot;#     display_name: &quot;Github&quot;#     client_id: &quot;your_client_id&quot;#     client_secret: &quot;your_client_secret&quot;#     redirect_uri: &quot;https://your-app.com/v1/user/oauth/callback/github&quot;# authentication:#   client:#     switch: false#     http_app_key:#     http_secret_key:#   site:#     switch: false# permission:#   switch: false#   component: false#   dataset: false\n\n\n\n3.2  运行配置\nsudo systemctl enable docker  # 启用 Docker 开机自启sudo systemctl start docker   # 立即启动 Docker（如果未运行）sudo docker compose -f docker-compose.yml up -d\n\n4. 启动与验证服务4.1 启动服务\n网络与防火墙检查\n# 宿主机防火墙放行sudo ufw allow 8000/tcpsudo ufw allow 80/tcpsudo ufw reload\n\n检查容器日志\nsudo docker logs vllm-deepseek --tail 100sudo docker logs ragflow-server --tail 100\n\n运行容器\n# 停止并删除容器（确保配置生效）sudo docker compose down# 后台启动服务（首次启动会下载模型，耗时较长）sudo docker compose -f docker-compose.yml up -d\n\n4.2 验证服务状态\n# 查看容器状态（均为 Up 则正常）sudo docker pshttp://localhost #访问ragflow\n\n5. 配置 RAGFlow 与使用\n访问界面：浏览器打开 http://服务器IP（注册账号密码）\n\n初始化配置：\n\n\n\n在「系统设置」→「LLM 配置」中，确认 vLLM 地址为 http://vllm-deepseek:8000/v1\n上传知识库文档（支持 PDF&#x2F;Word&#x2F;Markdown 等格式）\n模型类型：chat\n模型名称：deepseek-ai&#x2F;deepseek-coder-1.3b-instruct\n基础url：http://vllm-deepseek:8000/v1\n最大token数：4096\n\n\n测试 RAG 流程：\n\n\n在问答界面输入与文档相关的问题\n验证回答是否包含文档引用（确认 RAG 生效）\n\n常见问题解决\n模型下载失败：\n\n\n检查 HF_ENDPOINT 是否配置正确（国内推荐 https://hf-mirror.com）\n手动下载模型后挂载到 model_cache 卷（路径：&#x2F;root&#x2F;.cache&#x2F;huggingface&#x2F;hub）\n\n\nGPU 显存不足：\n\n\n改用更高量化级别：QUANTIZATION&#x3D;q2_k（最低显存需求～6GB）\n切换更小模型：deepseek-ai&#x2F;deepseek-llm-1.3b-chat（显存占用～4GB）\n\n\nRAGFlow 无法连接 vLLM：\n\n\n检查容器网络：docker network inspect llm-deepseek_default\n重启 vLLM 服务：docker restart vllm-deepseek\n\n扩展建议\n高可用配置：添加 Nginx 反向代理与 SSL 证书\n性能优化：\n增加 GPU_MEMORY_UTILIZATION&#x3D;0.9（利用 90% GPU 显存）\n启用模型预热：PRELOAD_MODELS&#x3D;[{“name”: “deepseek-ai&#x2F;deepseek-llm-7b-chat”, “parameters”: {“quantization”: “q4_k_m”}}]\n\n\n监控集成：添加 Prometheus + Grafana 监控 GPU 使用率与服务响应时间\n\n通过以上优化，部署流程更健壮，同时兼顾了国内网络环境与资源限制，适合快速搭建企业级 RAG 问答系统。\n参考：\n\ndocker\n\nvllm\n\nragflow\n\ndeepseek\n\n\n","categories":["AI"],"tags":["deepseek-vllm-ragflow"]},{"title":"Ubuntu Server","url":"/posts/2025/07/ubuntu-server/","content":"安装 Ubuntu 22.04 Server 搭建服务器以下是详细的安装流程，涵盖从准备工作到基础配置的全流程，适合新手参考\n一、安装前准备在开始安装前，需完成以下准备工作，避免安装过程中出现问题：\n\n硬件要求Ubuntu 22.04 Server 对硬件要求较低，基础配置如下（根据实际用途可提升）：\n\n\nCPU：至少 1 GHz 处理器（推荐双核及以上）\n内存：至少 1 GB RAM（推荐 2 GB 及以上，运行服务更流畅）\n硬盘：至少 20 GB 可用空间（机械硬盘 HDD 或固态硬盘 SSD 均可，SSD 速度更快）\n其他：网络接口（用于联网）、USB 接口（用于插入安装介质）\n\n\n下载安装镜像\n\n\n访问 Ubuntu 官方下载页：Ubuntu 22.04 LTS Server\n\n选择 “ubuntu-22.04.x-live-server-amd64.iso”（x 为具体版本号，如 22.04.5），下载到本地。\n\n\n\n\n\n制作启动介质（U 盘）需要将下载的 ISO 镜像写入 U 盘，作为安装启动盘：\n\n\n工具选择：\nWindows 系统：使用 Rufus（简单易用，支持 UEFI&#x2F;BIOS）\nmacOS&#x2F;Linux 系统：使用 dd 命令（终端操作，如 sudo dd if&#x3D;镜像路径 of&#x3D;&#x2F;dev&#x2F;sdX bs&#x3D;4M，注意替换 sdX 为 U 盘设备名）\n\n\n操作注意：写入前备份 U 盘数据（会被格式化），选择 “GPT” 分区格式（支持 UEFI 启动，更主流）。\n\n\n服务器启动设置将制作好的 U 盘插入服务器，重启服务器并进入 BIOS&#x2F;UEFI 设置：\n\n\n进入方式：开机时按提示按键（如 Del、F2、F12，不同品牌主板不同）\n关键设置：\n启动顺序：将 U 盘设为第一启动项（优先从 U 盘启动）\n关闭 “Secure Boot”（部分服务器可能需要，避免阻止非认证系统启动）\n\n\n保存设置并重启，服务器会从 U 盘启动，进入 Ubuntu 安装界面。\n\n二、开始安装（图形化引导流程）Ubuntu 22.04 Server 提供图形化安装界面，操作直观，按以下步骤逐步完成：\n\n初始界面选择启动后首先看到选择界面：\n\n\n选择 “Install Ubuntu Server”（安装 Ubuntu 服务器版，而非 “Try” 试用），按回车进入。\n\n\n语言与键盘设置\n\n\n语言选择：默认 “English”（推荐保持英文，避免后续命令行乱码，服务器一般用英文环境）。\n键盘布局：选择 “English (US)”（默认即可，如需其他布局可通过 “Detect Keyboard Layout” 检测）。\n\n\n网络配置（核心步骤）服务器必须联网（后续需下载更新、安装软件），此步骤需配置网络：\n\n\n默认情况：如果服务器连接了有线网络且路由器支持 DHCP，系统会自动获取 IP 地址（显示 “Connected”），直接按 “Done” 进入下一步即可。\n手动配置（如需固定 IP）：\n选择当前网络接口（如 “enp0s3”），按回车进入设置。\n选择 “Edit IPv4”，将 “Method” 从 “DHCP” 改为 “Manual”。\n填写信息：\nSubnet：子网（如 192.168.1.0&#x2F;24）\nAddress：服务器固定 IP（如 192.168.1.100）\nGateway：网关（路由器 IP，如 192.168.1.1）\nNameservers：DNS 服务器（如 8.8.8.8 或公司 DNS）\n\n\n填写完成后按 “Save” 保存，确认 “Connected” 后按 “Done”。\n\n\n\n\n代理与镜像源设置\n\n\n代理服务器：如果服务器需通过代理联网，填写代理地址（如 http://代理IP:端口）；无代理则留空，按 “Done”。\n镜像源设置：默认使用 Ubuntu 官方源（http://archive.ubuntu.com），但国内用户可替换为 国内镜像源（如阿里云、华为云），加快后续软件下载速度：\n替换为阿里云源：http://mirrors.aliyun.com/\n操作：删除默认地址，输入新地址后按 “Done”。\n\n\n\n\n磁盘分区（重要，需谨慎）此步骤分配硬盘空间，决定系统如何使用硬盘，推荐两种方式：\n\n方式 1：自动分区（新手首选）\n\n选择 “Use an entire disk”（使用整个硬盘），系统会自动创建分区（根目录 &#x2F;、swap 交换分区等），适合单硬盘、无特殊需求的场景。\n确认硬盘：选择需要安装系统的硬盘（注意不要选错，避免格式化其他硬盘）。\n勾选 “Set up this disk as an LVM group”（推荐，LVM 支持后续动态调整分区大小，灵活度高）。\n按 “Done” 进入确认界面，选择 “Continue”（提示会格式化硬盘，确认无误后继续）。\n\n方式 2：手动分区（适合进阶需求）如果需要自定义分区（如分离 &#x2F;home、&#x2F;var 目录，或多硬盘规划），选择 “Custom storage layout”，手动创建分区：\n\n基本分区建议（以 100GB 硬盘为例）：\n&#x2F;boot：512MB（启动分区，必须）\nswap：2GB（交换分区，内存小于 4GB 时建议设置，等于或大于内存）\n&#x2F;（根目录）：剩余全部空间（存放系统和软件）\n\n\n操作：选择硬盘 -&gt; “Add GPT Partition” -&gt; 填写大小、挂载点、文件系统（默认 ext4）。\n\n\n用户设置（创建管理员账户）\n\n\nProfile setup：设置服务器的基本用户信息：\nYour name：用户全名（如 “Server Admin”）\nServer name：服务器主机名（如 “ubuntu-server”，后续可通过 hostname 命令修改）\nUsername：登录用户名（如 “admin”，避免用 “root” 直接登录）\nPassword：登录密码（需复杂，至少 8 位，包含大小写、数字和符号）\n勾选 “Install OpenSSH server”（必须！安装 SSH 服务，后续可通过远程工具如 Xshell、Putty 登录服务器）。\n\n\n按 “Done” 进入下一步。\n\n\n可选软件安装（按需选择）此步骤可选择预装一些常用服务（通过 “Snaps” 安装，轻量化）：\n\n\n可选项目：如 “Docker”“Kubernetes”“LAMP Server” 等，新手暂时不选（后续需要时再手动安装更灵活）。\n直接按 “Done”，进入安装过程（系统开始写入硬盘、安装基础组件）。\n\n\n完成安装\n\n\n安装过程需要几分钟（取决于硬件速度和网络，若之前选了镜像源，速度会更快）。\n出现 “Installation complete” 提示后，按 “Reboot Now” 重启服务器。\n重启前会提示 “Please remove the installation medium”，拔出 U 盘，按回车确认，服务器将从硬盘启动。\n\n三、安装后验证与基础配置重启后，服务器会显示登录界面（提示 “username@hostname:~$”），输入之前设置的用户名和密码登录，完成以下验证和配置：\n\n验证登录与网络\n\n\n登录后，输入 ip addr 命令，查看网络是否正常（是否有 IP 地址）。\n输入 ping baidu.com，测试能否联网（能收到回复说明网络正常，按 Ctrl+C 停止）。\n\n\n切换到 root 用户（可选）默认用户是普通用户，需使用 sudo 执行管理员命令。若习惯用 root，可启用 root 账户：\n\n# 设置 root 密码（首次使用需初始化）sudo passwd root# 输入当前用户密码，再输入 root 新密码# 切换到 root 用户su - root\n\n\n更新系统（推荐）安装完成后，先更新系统到最新版本，修复漏洞：\n\nsudo apt update  # 更新软件源索引sudo apt upgrade -y  # 升级所有软件包（-y 自动确认）\n\n\n远程登录测试（关键）在本地电脑通过 SSH 工具（如 Xshell、FinalShell）连接服务器，验证远程管理是否正常：\n\n\n连接信息：IP 地址（通过 ip addr 查看）、用户名（安装时设置的）、密码。\n命令行连接（本地为 Linux&#x2F;macOS）：ssh 用户名@服务器IP（如 ssh admin@192.168.1.100）。\n若能成功登录，说明 SSH 服务正常，后续可脱离服务器显示器，远程管理。\n\n四、常见问题与解决\n\n安装时无法联网：\n\n\n检查网线是否插好，路由器是否正常。\n若 DHCP 失败，手动配置 IP（参考步骤 3 的 “手动配置”）。\n\n\n分区时提示 “无可用磁盘”：\n\n\n确认硬盘已正确识别（在分区界面查看是否有硬盘列表）。\n若硬盘之前有其他系统，可先删除原有分区（选择硬盘 -&gt; “Delete”）。\n\n\n重启后无法进入系统：\n\n\n检查 BIOS 启动顺序是否已改为硬盘（安装后需将硬盘设为第一启动项）。\n若提示 “grub rescue”，可能是分区错误，重新安装并正确分区。\n\n\n远程 SSH 无法连接：\n\n\n确认安装时勾选了 “Install OpenSSH server”，若未勾选，登录服务器后手动安装：sudo apt install openssh-server。\n检查防火墙：默认 Ubuntu 防火墙不拦截 SSH，若开启需放行：sudo ufw allow ssh。\n\n\n在 Ubuntu 系统中，修改多系统启动顺序\n\n\nGRUB Customizer（图形界面工具）\n安装方法：在终端中依次执行以下命令\nsudo add-apt-repository ppa:danielrichter2007/grub-customizersudo apt updatesudo apt install grub-customizer\n\n使用方法：安装完成后，在终端输入grub-customizer启动工具，或通过应用菜单搜索打开。打开后，在列表中选择要设置为默认的系统，点击 “设置为默认”，最后点击 “保存” 即可\n\n常规设置(G)-&gt; 默认项-&gt;预订义(D):-&gt;选择 -&gt;保存\n文件(F)-&gt; 安装到MBR(I)……\n\n\n\n\n\n\n在ubuntu 系统中，命令方式连接wifi\n\n\n\n确保无线网卡已启用且可用\n   ip link show  # 查找wlan0或类似无线接口名，确认状态为UP\n\n   手动安装wifi驱动\n   \n    设置\n     sudo apt install gcc  make -y #安装gcc  sudo dpkg -i xxx.deb  #安装网卡xxx.deb文件  sudo apt install net-tools # ifconfig  sudo apt install network-manager #安装 network-manager  #nmcli配置 WIFI  sudo nmcli device wifi list #查看Wifi  sudo nmcli connection add type wifi con-name &quot;-&quot; ifname &quot;*&quot;   ssid &quot;wifi&quot; 802-11-wireless.hidden yes 802-11-wireless-security.key-mgmt wpa-psk 802-11-wireless-security.psk &quot;8AhbBvdf&quot; connection.autoconnect yes #连接Wifi  sudo nmcli connection show #查看连接  sudo nmcli connection delete &quot;wifi&quot; #删除连接```‌```bash#使用 cloud-init 配置网络sudo nano /etc/cloud/cloud.cfg.d/99-custom-networking.cfg\n\n   #A start job is running for wait for network to be Configured# 获取实际接口名称INTERFACE=$(ip addr | grep -v &#x27;^[0-9]*: lo&#x27; | grep -oP &#x27;^[0-9]*: \\K[^:]+&#x27;)# 创建正确的配置文件sudo mkdir -p /etc/systemd/system/systemd-networkd-wait-online.service.decho &quot;[Service]ExecStart=ExecStart=/lib/systemd/systemd-networkd-wait-online --interface=$INTERFACETimeoutStartSec=30&quot; | sudo tee /etc/systemd/system/systemd-networkd-wait-online.service.d/override.conf# 重新加载并启动服务sudo systemctl daemon-reloadsudo systemctl restart systemd-networkd-wait-online\n\n   \n\n\n\n在 Ubuntu 系统中，可通过设置网络共享和 IP 转发，使一台通过 WiFi 上网的电脑将网络共享给另一台通过网线连接的电脑。以下是具体操作步骤‌：\n   \n        设置\n\n\n配置主机（能上网的电脑）：\n\n查看网卡名称：打开终端，输入命令iwconfig，查看无线网卡和有线网卡的名称，通常无线网卡名称类似wlo1，有线网卡名称类似eth0，需记住这两个名称，后续配置会用到。\n\n设置有线网卡静态 IP：执行命令sudo ifconfig eth0 10.42.0.1&#x2F;24，将有线网卡的 IP 地址设置为10.42.0.1，子网掩码为255.255.255.0。可通过ifconfig命令查看配置是否成功。\n\n开启 IP 转发：临时开启可在终端输入sudo echo “1”&gt;&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward。若要永久开启，可使用命令sudo vim &#x2F;etc&#x2F;sysctl.conf，打开文件后，添加或取消注释net.ipv4.ip_forward &#x3D; 1，保存并退出，然后执行sudo sysctl -p使设置生效。 配置 NAT 规则：在终端依次输入以下命令，配置 iptables 规则，清除原有规则并允许数据包转发，设置 NAT 转换。\n  # 设置NAT规则sudo iptables -t nat -A POSTROUTING -o wlo1 -j MASQUERADE# 允许转发流量sudo iptables -A FORWARD -i wlo1 -o enp7s0 -m state --state RELATED,ESTABLISHED -j ACCEPTsudo iptables -A FORWARD -i enp7s0 -o wlo1 -j ACCEPT# 保存规则sudo apt-get install iptables-persistent       sudo netfilter-persistent save\n\n  其中wlo1需替换为实际的无线网卡名称。\n  # VPN# 设置NAT规则sudo iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE# 允许转发流量sudo iptables -A FORWARD -i ppp0 -o enp7s0 -m state --state RELATED,ESTABLISHED -j ACCEPTsudo iptables -A FORWARD -i enp7s0 -o ppp0 -j ACCEPT# 保存规则sudo apt-get install iptables-persistentsudo netfilter-persistent save\n\n其中ppp0需替换为VPN拨号网卡名称。\n\n\n配置从机（待上网的电脑）：\n\n设置静态 IP：在终端执行sudo ifconfig eth1 10.42.0.2&#x2F;24，将有线网卡的 IP 地址设置为10.42.0.2，子网掩码为255.255.255.0，eth1需替换为实际的有线网卡名称。\n设置网关和 DNS：输入以下命令设置网关为10.42.0.1，并设置 DNS 服务器为223.5.5.5。\n\nsudo route add -net 0.0.0.0/0 gw 10.42.0.1sudo chmod +666 /etc/resolv.conf sudo echo &quot;nameserver 223.5.5.5&quot; &gt; /etc/resolv.conf\n\n\n\n\n\n  \n\n\nroot账户设置密码\n\n\n当前普通用户界面下输入命令，然后按提示两次输入密码即可。\nsudo passwd root\n\n\n\n驱动更新\n\n\n更新驱动\n\n\n系统准备 首先更新系统并安装必要的依赖：\n\n\n\n sudo apt updatesudo apt upgrade -ysudo apt install -y build-essential dkms linux-headers-$(uname -r)\n\n\n\n添加 NVIDIA 软件源\n\n\n\nsudo add-apt-repository ppa:graphics-drivers/ppasudo apt update\n\n\n\n确定推荐的驱动版本\n\n\n\nubuntu-drivers devices\n\n\n\n安装驱动\n\n\n\nsudo apt install -y nvidia-driver-XXX  # 使用上一步推荐的版本号\n\n\n\n配置内核模块（可选）如果遇到驱动冲突，创建配置文件禁用开源驱动：\n\n\n\nsudo tee /etc/modprobe.d/blacklist-nouveau.conf &lt;&lt;EOFblacklist nouveauoptions nouveau modeset=0EOF\n\n更新内核 initramfs：\nsudo update-initramfs -u\n\n\n\n重启系统\n\n\n\nsudo reboot\n\n\n\n验证安装\n\n\n\nnvidia-smi\n\n\n\n安装 CUDA Toolkit（可选） 若需要 GPU 计算能力（如运行 VLLM），安装 CUDA：\n\n\n\n# rsync -avz -e ssh &lt;云服务器实例登录名&gt;@&lt;云服务器实例公网IP地址&gt;:&lt;实例文件或文件夹路径&gt; &lt;本地目录&gt;# 添加 CUDA 12.9 仓库wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pinsudo mv cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600wget -c https://developer.download.nvidia.com/compute/cuda/12.9.0/local_installers/cuda-repo-ubuntu2204-12-9-local_12.9.0-575.51.03-1_amd64.debsudo dpkg -i cuda-repo-ubuntu2204-12-9-local_12.9.0-575.51.03-1_amd64.debsudo cp /var/cuda-repo-ubuntu2204-12-9-local/cuda-*-keyring.gpg /usr/share/keyrings/sudo apt-get update# 安装 CUDA Toolkit（不含驱动，因已安装 575）sudo apt-get -y install cuda-toolkit-12-9# 设置环境变量echo &#x27;export PATH=/usr/local/cuda-12.9/bin:$PATH&#x27; &gt;&gt; ~/.bashrcecho &#x27;export LD_LIBRARY_PATH=/usr/local/cuda-12.9/lib64:$LD_LIBRARY_PATH&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc \n\n\n\n安装 cuDNN 9.10.2\n\n\n\n# 安装 cuDNN 9.10.2（CUDA 12.9 推荐版本）wget -c https://developer.download.nvidia.com/compute/cudnn/9.10.2/local_installers/cudnn-local-repo-ubuntu2204-9.10.2_1.0-1_amd64.debsudo dpkg -i cudnn-local-repo-ubuntu2204-9.10.2_1.0-1_amd64.debsudo cp /var/cudnn-local-repo-ubuntu2204-9.10.2/cudnn-*-keyring.gpg /usr/share/keyrings/sudo apt-get updatesudo apt-get -y install cudnn\n\n\n\n验证安装\n\n\n\nnvcc --version  # 应显示 release 12.9#cat /usr/include/cudnn_version.h | grep CUDNN_MAJOR -A 2  # 应显示 8.10.5cat /usr/include/x86_64-linux-gnu/cudnn_version.h | grep CUDNN_MAJOR -A 2\n\n常见问题解决方案\n\n\n驱动安装失败：尝试使用 NVIDIA 官方.run 文件安装\n\n\n\n登录循环问题：可能是驱动与 Xorg 冲突，尝试以安全模式登录并重新安装\n\n\n\nCUDA 版本不兼容：确保 VLLM 支持的 CUDA 版本与安装的一致\n\n\n\n完成这些步骤后，你的系统应能正常识别并使用 NVIDIA GPU，可顺利运行基于 GPU 加速的 VLLM 和 Deepseek 模型。\n\n\n\n7.禁止自动休眠\n\n\n执行如下命令查看休眠模式的情况，如果sleep状态是loaded，也就是处于自动休眠开启状态\n\nsystemctl status sleep.target\n\n2.接下来，执行如下命令关闭系统的自动休眠开关：\n# 这些命令做了以下几点：# 通过mask命令，你禁用了所有休眠相关的systemd目标。# 通过set-default命令，你设置默认的运行级别为多用户文本模式（即命令行界面）sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.targetsudo systemctl set-default multi-user.target##################################################### 如果你想要恢复自动休眠功能，可以使用以下命令：sudo systemctl unmask sleep.target suspend.target hibernate.target hybrid-sleep.targetsudo systemctl set-default graphical.target\n\n\n再次执行查看命令，可以看到sleep的状态已经变成了masked，也就是关闭了。\n\n\n\n编辑/etc/systemd/logind.conf文件：\n\nsudo nano /etc/systemd/logind.conf\n\n\n在文件中找到以下行：\n\n#IdleAction=#IdleActionSec=\n\n\n将这两行的注释符号#移除，并设置IdleAction为ignore，IdleActionSec为0，如下所示：\n\nIdleAction=ignoreIdleActionSec=0\n\n\n保存文件并关闭编辑器\n\n\n\n使用以下命令重新加载systemd配置：\n\nsudo systemctl restart systemd-logind.service\n\n\n完成！现在Ubuntu Server 22.04将不会因为无操作而自动休眠。\n\n\n\n\n8.定时自动关闭显示器\n\n\n想要定时关闭显示器，可以编辑/etc/default/grub这个文件\n\n\n\n通过修改GRUB_CMDLINE_LINUX_DEFAULT变量，你可以添加或修改传递给内核的参数，以便在启动时对系统进行自定义配置。\n\n# ipv6.disable=1：禁用 IPv6 协议。# consoleblank=300：设置控制台空闲时间为 300 秒后自动关闭。GRUB_CMDLINE_LINUX_DEFAULT=&quot;ipv6.disable=1 consoleblank=300&quot;\n\n\n修改完了运行sudo update-grub，然后重启，即可设置系统5分钟没有活动自动关闭显示器。\n\n\n\n\n\n","categories":["Ubuntu"],"tags":["ubuntu-server"]}]